{% extends 'base.html' %}
{% load can %}

{% block title %}{{ titulo }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h4 m-0">{{ titulo }}</h1>
    <div>
        <a href="{% url 'talleres:lista_talleres_archivados' %}" class="btn btn-outline-secondary">
            Ver Historial
        </a>
        
        {% user_can 'talleres' 'create' as can_create_taller %}
        {% if can_create_taller %}
        <a href="{% url 'talleres:crear_taller' %}" class="btn btn-primary ms-2">
            Programar Nuevo Taller
        </a>
        {% endif %}
    </div>
</div>

<div class="row">

    {% for taller in talleres %}
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="card shadow-sm h-100">
            
            <div class="card-header">
                <h5 class="mb-0">{{ taller.nombre }}</h5>
            </div>
            
            <div class="card-body d-flex flex-column">
                <p class="card-text">{{ taller.descripcion|truncatewords:30 }}</p>
                
                <ul class="list-unstyled small text-muted mt-auto">
                    <li>
                        <strong>Inicio:</strong>
                        {{ taller.fecha_inicio|date:"d/m/Y H:i" }}
                    </li>
                    <li>
                        <strong>Fin:</strong>
                        {{ taller.fecha_termino|date:"d/m/Y H:i" }}
                    </li>
                </ul>
            </div>
            
            <div class="card-footer bg-light">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="badge bg-primary rounded-pill">
                        {{ taller.cupos_disponibles }} cupos de {{ taller.cupos_totales }}
                    </span>
                    
                    <a href="{% url 'talleres:detalle_taller' taller.pk %}" class="btn btn-sm btn-outline-primary">
                        Ver Detalles
                    </a>
                </div>

                <div class="text-end">
                    {% user_can 'talleres' 'edit' as can_edit_taller %}
                    {% if can_edit_taller %}
                    <a href="{% url 'talleres:editar_taller' taller.pk %}" class="btn btn-sm btn-outline-secondary">
                        Editar
                    </a>
                    {% endif %}
                    
                    {% user_can 'talleres' 'delete' as can_delete_taller %}
                    {% if can_delete_taller and taller.es_cancelable %}
                    <a href="{% url 'talleres:cancelar_taller' taller.pk %}" class="btn btn-sm btn-warning ms-1">
                        Cancelar
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="alert alert-info" role="alert">
            No hay talleres programados.
        </div>
    </div>
    {% endfor %}

</div>
{% endblock %}
