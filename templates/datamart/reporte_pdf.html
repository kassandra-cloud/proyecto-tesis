<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Informe de Gestión - Inteligencia de Negocios</title>
    <style>
        body {
            font-family: Helvetica, Arial, sans-serif;
            font-size: 11pt;
        }
        h1, h2, h3 {
            margin: 0;
            padding: 0;
        }
        .header {
            text-align: center;
            margin-bottom: 16px;
        }
        .subheader {
            font-size: 10pt;
            margin-bottom: 12px;
        }
        .section {
            margin-top: 14px;
            margin-bottom: 10px;
        }
        .section h2 {
            font-size: 12pt;
            margin-bottom: 4px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 4px;
            margin-bottom: 6px;
        }
        th, td {
            border: 1px solid #999;
            padding: 3px 4px;
            font-size: 9pt;
        }
        th {
            background-color: #f0f0f0;
        }
        .small {
            font-size: 9pt;
        }
    </style>
</head>
<body>

<div class="header">
    <h1>Informe de Gestión - Inteligencia de Negocios</h1>
    <h3>Junta de Vecinos "Villa Vista al Mar"</h3>
</div>

<div class="subheader">
    <p class="small">
        <strong>Generado por:</strong> {{ usuario }}<br>
        <strong>Fecha:</strong> {{ fecha_generacion|date:"d/m/Y H:i" }}<br>
        <strong>Total Vecinos Registrados:</strong>
        {% if participacion %}
            {{ participacion.total_vecinos }}
        {% else %}
            0
        {% endif %}<br>
        <strong>Vecinos Participantes (Votaciones):</strong>
        {% if participacion %}
            {{ participacion.total_participantes }}
        {% else %}
            0
        {% endif %}<br>
        <strong>Tasa de Participación Global:</strong>
        {% if participacion %}
            {{ participacion.porcentaje_actual|floatformat:1 }} %
        {% else %}
            0.0 %
        {% endif %}
    </p>
</div>

<hr>

<!-- 1. Distribución Demográfica (Por Sector) -->
<div class="section">
    <h2>1. Distribución Demográfica (Por Sector)</h2>

    {% if demografia_sector %}
        <table>
            <thead>
                <tr>
                    <th>Sector / Dirección</th>
                    <th>Cantidad de Vecinos</th>
                </tr>
            </thead>
            <tbody>
                {% for d in demografia_sector %}
                    <tr>
                        <td>{{ d.direccion_sector }}</td>
                        <td>{{ d.total_vecinos }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p class="small">No hay datos disponibles.</p>
    {% endif %}
</div>

<!-- 2. Ocupación de Talleres -->
<div class="section">
    <h2>2. Ocupación de Talleres</h2>

    {% if ocupacion_talleres %}
        <table>
            <thead>
                <tr>
                    <th>Nombre del Taller</th>
                    <th>Inscritos</th>
                    <th>Cupos Totales</th>
                    <th>Estado</th>
                </tr>
            </thead>
            <tbody>
                {% for t in ocupacion_talleres %}
                    <tr>
                        <td>{{ t.nombre }}</td>
                        <td>{{ t.inscritos }}</td>
                        <td>{{ t.cupos }}</td>
                        <td>
                            {% if t.cupos|default:0 > 0 and t.inscritos >= t.cupos %}
                                Completo
                            {% elif t.inscritos > 0 %}
                                Con cupos disponibles
                            {% else %}
                                Sin inscritos
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p class="small">No hay talleres registrados.</p>
    {% endif %}
</div>

<!-- 3. Transparencia: Actas Más Consultadas -->
<div class="section">
    <h2>3. Transparencia: Actas Más Consultadas</h2>

    {% if consulta_actas %}
        <table>
            <thead>
                <tr>
                    <th>Título del Acta</th>
                    <th>Fecha Reunión</th>
                    <th>Total Consultas</th>
                </tr>
            </thead>
            <tbody>
                {% for a in consulta_actas %}
                    <tr>
                        <td>{{ a.acta__titulo }}</td>
                        <!-- Si no tienes fecha en el queryset, mostramos "-" -->
                        <td>-</td>
                        <td>{{ a.consultas }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p class="small">No se han registrado consultas aún.</p>
    {% endif %}
</div>

</body>
</html>
