{% extends "base_public.html" %} {# Extendemos de la base pública limpia #}
{% load widget_tweaks %}
{% load static %} {# Asegúrate de cargar static para tu logo #}

{% block title %}Iniciar sesión{% endblock %}

{% block content %}
<style>
  /* Estilos específicos para el login */
  .login-container {
    background: #fff; /* Fondo blanco para todo el contenedor de login */
    border-radius: 1rem;
    overflow: hidden; /* Asegura que la ilustración no se salga de los bordes redondeados */
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
    max-width: 900px; /* Ancho máximo para el contenedor del login */
    width: 100%; /* Ocupa todo el ancho disponible hasta el max-width */
  }

  .login-illustration-side {
    background: linear-gradient(135deg, #287bff, #5c9ff7); /* Degradado azul, ajusta los colores a tu gusto */
    color: white;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 2rem;
    text-align: center;
  }

  .login-form-side {
    padding: 3rem; /* Espaciado interno para el formulario */
  }

  /* Asegura que el SVG del icono se vea bien en blanco */
  .login-form-side .bi-person-circle {
    color: #287bff !important; /* Color azul para el icono principal */
  }

  /* Ajuste para el texto "Junta de vecinos" en la ilustración */
  .illustration-text {
    font-size: 1.5rem;
    font-weight: 600;
    margin-top: 1rem;
  }

  /* Estilos para el campo de entrada con iconos */
  .input-group-custom .form-control {
    border-left: none; /* Quitar borde izquierdo del input para fusionar con el icono */
  }
  .input-group-custom .input-group-text {
    background-color: #e9ecef; /* Fondo claro para el icono */
    border-right: none; /* Quitar borde derecho del icono */
  }

  .btn-primary {
    background-color: #287bff; /* Color del botón primario */
    border-color: #287bff;
  }
  .btn-primary:hover {
    background-color: #1a62cc; /* Un azul un poco más oscuro al pasar el ratón */
    border-color: #1a62cc;
  }

  .input-group-custom.form-floating > .form-control:focus ~ label,
  .input-group-custom.form-floating > .form-control:not(:placeholder-shown) ~ label,
  .input-group-custom.form-floating > .form-control:-webkit-autofill ~ label {
      opacity: .65;
      /* Quitamos el 'translateX(.15rem)' que Bootstrap añade por defecto.
        De esta forma, la etiqueta flotada respeta el 'padding-left: 3rem' 
        (de la clase ps-5) exactamente igual que el texto del input.
      */
      transform: scale(.85) translateY(-.5rem) translateX(0); 
  }

  /* Botón de mostrar/ocultar contraseña */
  .password-toggle-btn {
    position: absolute;
    right: 0.75rem;
    top: 50%;
    transform: translateY(-50%);
    border: none;
    background: transparent;
    cursor: pointer;
    z-index: 3;
    padding: 0;
  }
  .password-toggle-btn i {
    pointer-events: none;
  }
</style>

<div class="login-container row g-0"> {# g-0 para quitar el gap entre columnas #}
  
  {# Lado de la ilustración #}
  <div class="col-md-6 d-none d-md-flex login-illustration-side">
    <div>
      <img src="{% static 'img/logo2.jpeg' %}" alt="Logo Junta de Vecinos" class="mb-3 rounded-circle" style="width: 120px; height: 120px; object-fit: cover;">
      <h2 class="illustration-text">Bienvenido a la Plataforma</h2>
      <p class="lead">Gestión de la Junta de Vecinos "Villa vista al mar"</p>
      {# Puedes añadir más elementos aquí, como un SVG representativo de una comunidad o casas #}
      {# Por ahora, dejamos el texto y el logo, que ya da identidad #}
    </div>
  </div>

  {# Lado del formulario de login #}
  <div class="col-md-6 login-form-side">
    <div class="text-center mb-5">
      <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
        <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
        <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/>
      </svg>
      <h1 class="h3 fw-normal mt-3">Iniciar sesión</h1>
    </div>
    
    {% if form.errors %}
      <div class="alert alert-danger" role="alert">
        Usuario o contraseña incorrectos.
      </div>
    {% endif %}

    <form method="post" action="{% url 'login' %}">
      {% csrf_token %}

      <div class="form-floating input-group-custom mb-3">
        <span class="input-group-text position-absolute start-0 h-100 rounded-start border-end-0" style="z-index: 2;"><i class="fas fa-user"></i></span>
        {{ form.username|add_class:"form-control ps-5"|attr:"placeholder: " |attr:"id:floatingInput" }}
        <label for="floatingInput" class="ps-5">Usuario</label>
      </div>

      {# Campo de contraseña con icono mostrar/ocultar #}
      <div class="form-floating input-group-custom mb-3 position-relative">
        <span class="input-group-text position-absolute start-0 h-100 rounded-start border-end-0" style="z-index: 2;"><i class="fas fa-lock"></i></span>
        {{ form.password|add_class:"form-control ps-5 pe-5"|attr:"placeholder: " |attr:"id:floatingPassword" }}
        <label for="floatingPassword" class="ps-5">Contraseña</label>

        <button type="button" class="password-toggle-btn" id="togglePassword" aria-label="Mostrar u ocultar contraseña">
          <i class="fas fa-eye"></i>
        </button>
      </div>

      {% if next %}
        <input type="hidden" name="next" value="{{ next }}">
      {% endif %}

      <div class="d-grid mt-4">
        <button class="btn btn-primary btn-lg w-100" type="submit">Entrar</button>
      </div>
    </form>

    <div class="text-center mt-4">
      <a href="{% url 'web_recuperar_paso1' %}" class="text-decoration-none text-primary">¿Olvidaste tu contraseña?</a>
    </div>
    
  </div> {# Fin del lado del formulario #}

</div> {# Fin del login-container #}

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const togglePassword = document.getElementById('togglePassword');
    const passwordInput = document.getElementById('floatingPassword');

    if (togglePassword && passwordInput) {
      togglePassword.addEventListener('click', function () {
        const isPassword = passwordInput.type === 'password';
        passwordInput.type = isPassword ? 'text' : 'password';

        const icon = this.querySelector('i');
        if (icon) {
          icon.classList.toggle('fa-eye');
          icon.classList.toggle('fa-eye-slash');
        }
      });
    }
  });
</script>

{% endblock %}
