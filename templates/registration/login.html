{% extends "base_public.html" %} {# Base pública limpia #}
{% load widget_tweaks %}
{% load static %}

{% block title %}Iniciar sesión{% endblock %}

{% block content %}
<style>
  /* Estilos específicos para el login */
  .login-container {
    background: #fff;
    border-radius: 1rem;
    overflow: hidden; /* evita desbordes en bordes redondeados */
    box-shadow: 0 0.5rem 1rem rgba(0,0,0,.1);
    max-width: 900px;
    width: 100%;
  }

  .login-illustration-side {
    background: linear-gradient(135deg, #287bff, #5c9ff7);
    color: #fff;
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    padding: 2rem; text-align: center;
  }

  .login-form-side { padding: 3rem; }

  .login-form-side .bi-person-circle { color: #287bff !important; }

  .illustration-text { font-size: 1.5rem; font-weight: 600; margin-top: 1rem; }

  .input-group-custom .form-control { border-left: none; }
  .input-group-custom .input-group-text {
    background-color: #e9ecef;
    border-right: none;
  }

  .btn-primary { background-color: #287bff; border-color: #287bff; }
  .btn-primary:hover { background-color: #1a62cc; border-color: #1a62cc; }

  /* Ajuste label flotante con padding izquierdo ps-5 */
  .input-group-custom.form-floating > .form-control:focus ~ label,
  .input-group-custom.form-floating > .form-control:not(:placeholder-shown) ~ label,
  .input-group-custom.form-floating > .form-control:-webkit-autofill ~ label {
      opacity: .65;
      transform: scale(.85) translateY(-.5rem) translateX(0);
  }

  /* Botón ojo: aspecto */
  .toggle-password { z-index: 2; }
  .toggle-password:hover { opacity: .8; }
</style>

<div class="login-container row g-0 mx-auto my-5">
  {# Lado ilustración #}
  <div class="col-md-6 d-none d-md-flex login-illustration-side">
    <div>
      <img src="{% static 'img/logo2.jpeg' %}" alt="Logo Junta de Vecinos"
           class="mb-3 rounded-circle" style="width:120px;height:120px;object-fit:cover;">
      <h2 class="illustration-text">Bienvenido a la Plataforma</h2>
      <p class="lead mb-0">Gestión de la Junta de Vecinos "Villa vista al mar"</p>
    </div>
  </div>

  {# Lado formulario #}
  <div class="col-md-6 login-form-side">
    <div class="text-center mb-5">
      <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="currentColor"
           class="bi bi-person-circle" viewBox="0 0 16 16">
        <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
        <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/>
      </svg>
      <h1 class="h3 fw-normal mt-3">Iniciar sesión</h1>
    </div>

    {% if form.errors %}
      <div class="alert alert-danger" role="alert">
        Usuario o contraseña incorrectos.
      </div>
    {% endif %}

    <form method="post" action="{% url 'login' %}">
      {% csrf_token %}

      {# Usuario #}
      <div class="form-floating input-group-custom mb-3 position-relative">
        <span class="input-group-text position-absolute start-0 h-100 rounded-start border-end-0" style="z-index:2;">
          <i class="fas fa-user"></i>
        </span>
        {{ form.username|add_class:"form-control ps-5"|attr:"placeholder: "|attr:"id:floatingInput" }}
        <label for="floatingInput" class="ps-5">Usuario</label>
      </div>

      {# Contraseña con ojo #}
      <div class="form-floating input-group-custom mb-3 position-relative">
        <span class="input-group-text position-absolute start-0 h-100 rounded-start border-end-0" style="z-index:2;">
          <i class="fas fa-lock"></i>
        </span>

        {# pe-5 para que no tape el texto el botón del ojo #}
        {{ form.password|add_class:"form-control ps-5 pe-5"|attr:"placeholder: "|attr:"id:floatingPassword"|attr:"autocomplete: current-password"|attr:"type: password" }}
        <label for="floatingPassword" class="ps-5">Contraseña</label>

        {# Botón ojo a la derecha #}
        <button type="button"
                class="btn position-absolute end-0 top-0 h-100 d-flex align-items-center px-3 border-0 bg-transparent toggle-password"
                aria-label="Mostrar u ocultar contraseña"
                title="Mostrar/Ocultar contraseña">
          <i class="fas fa-eye" aria-hidden="true"></i>
        </button>
      </div>

      {% if next %}
        <input type="hidden" name="next" value="{{ next }}">
      {% endif %}

      <div class="d-grid mt-4">
        <button class="btn btn-primary btn-lg w-100" type="submit">Entrar</button>
      </div>
    </form>

    <div class="text-center mt-4">
      <a href="{% url 'password_reset' %}" class="text-decoration-none text-primary">¿Olvidaste tu contraseña?</a>
    </div>
  </div>
</div>

{# Script del botón ojo #}
<script>
  (function () {
    const toggleBtn = document.querySelector('.toggle-password');
    const input = document.getElementById('floatingPassword');
    if (!toggleBtn || !input) return;

    toggleBtn.addEventListener('click', function () {
      const icon = this.querySelector('i');
      const isPassword = input.getAttribute('type') === 'password';
      input.setAttribute('type', isPassword ? 'text' : 'password');

      if (isPassword) {
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
        this.setAttribute('aria-label', 'Ocultar contraseña');
      } else {
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
        this.setAttribute('aria-label', 'Mostrar contraseña');
      }
    });
  })();
</script>
{% endblock %}
