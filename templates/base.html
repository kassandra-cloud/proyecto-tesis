{% load static %}
{% load can %}
<!doctype html>
<html lang="es" data-bs-theme="light">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}Proyecto de Tesis{% endblock %}</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

  <link rel="stylesheet" href="{% static 'css/main.css' %}">

</head>

<body>

  <nav class="navbar navbar-expand top-navbar position-relative">
    <div class="container-fluid">
      
      <button class="btn btn-outline-light" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarOffcanvas" aria-controls="sidebarOffcanvas">
        <i class="fas fa-bars"></i> </button>

      <a class="navbar-brand d-flex align-items-center position-absolute start-50 translate-middle-x" href="{% url 'home' %}">
        <img src="{% static 'img/logo3.png' %}" alt="Logo Junta de Vecinos" class="me-2"
          style="height:40px; width:auto;">
        <span class="fw-semibold text-white">Junta de vecinos “Villa vista al mar”</span>
      </a>

      <ul class="navbar-nav ms-auto">
        {% if user.is_authenticated %}
        <li class="nav-item dropdown ms-lg-3">

          <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userMenu" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <div class="text-center" style="line-height: 1;">
                <span class="d-block">{{ user.username }}</span>
                {% if user.perfil %}
                    <small class="text-white" style="font-size: 0.75em; opacity: 0.8;">Sesión iniciada • {{ user.perfil.get_rol_display }}</small>
                {% endif %}
            </div>
          </a>
          
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenu">
            <li class="px-3 py-2">
              <form method="post" action="{% url 'logout' %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-outline-danger w-100">Cerrar sesión</button>
              </form>
            </li>
          </ul>
        </li>
        {% else %}
        <li class="nav-item ms-lg-3">
          <a class="btn btn-outline-light btn-sm" href="{% url 'login' %}">Iniciar sesión</a>
        </li>
        {% endif %}
      </ul>

    </div>
  </nav>

  <div class="offcanvas offcanvas-start sidebar-offcanvas" tabindex="-1" id="sidebarOffcanvas" aria-labelledby="sidebarLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="sidebarLabel">Menú de Navegación</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>

    <div class="offcanvas-body">
      <ul class="sidebar-nav nav flex-column">
        <li class="nav-item">
          <a class="nav-link {% if request.resolver_match.url_name == 'home' %}active{% endif %}" href="{% url 'home' %}">
            <i class="fas fa-home icon"></i>
            <span>Panel Principal</span>
          </a>
        </li>
        
        {% user_can 'usuarios' 'view' as puede_ver_usuarios %}
        {% if puede_ver_usuarios %}
        <li class="nav-item">
          <a class="nav-link {% if request.resolver_match.app_name == 'usuarios' %}active{% endif %}" href="{% url 'lista_usuarios' %}">
            <i class="fas fa-users icon"></i>
            <span>Usuarios</span>
          </a>
        </li>
        {% endif %}

        {% user_can 'reuniones' 'view' as puede_ver_reuniones %}
        {% if puede_ver_reuniones %}
        <li class="nav-item">
          <a class="nav-link {% if request.resolver_match.app_name == 'reuniones' %}active{% endif %}" href="{% url 'reuniones:lista_reuniones' %}">
            <i class="fas fa-calendar-alt icon"></i>
            <span>Reuniones</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.resolver_match.app_name == 'foro' %}active{% endif %}" href="{% url 'lista_publicaciones' %}">
            <i class="fas fa-comments icon"></i>
            <span>Foro</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.resolver_match.app_name == 'anuncios' %}active{% endif %}" href="{% url 'anuncios:lista_anuncios' %}">
            <i class="fas fa-bullhorn icon"></i>
            <span>Anuncios</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.resolver_match.app_name == 'talleres' %}active{% endif %}" href="{% url 'lista_talleres' %}">
            <i class="fas fa-tools icon"></i>
            <span>Talleres</span>
          </a>
        </li>
        
        {% user_can 'recursos' 'view' as puede_ver_recursos %}
        {% if puede_ver_recursos %}
        <li class="nav-item">
          <a class="nav-link {% if request.resolver_match.app_name == 'recursos' %}active{% endif %}" href="{% url 'recursos:lista_recursos' %}">
            <i class="fas fa-calendar-check icon"></i>
            <span>Recursos</span>
          </a>
        </li>
        {% endif %}
        {% endif %}       
        
        {% user_can 'votaciones' 'view' as puede_ver_votaciones %}
        {% if puede_ver_votaciones %}
        <li class="nav-item">
          <a class="nav-link {% if request.resolver_match.app_name == 'votaciones' %}active{% endif %}" href="{% url 'votaciones:lista_votaciones' %}">
            <i class="fas fa-vote-yea icon"></i>
            <span>Votaciones</span>
          </a>
        </li>
        {% endif %}
      </ul>
    </div>
  </div>


  <main class="main-content">
    <div class="container py-4">
      
      {% block content %}{% endblock %}
    </div>
</main>

  <script src="https://unpkg.com/htmx.org@1.9.10" integrity="sha384-D1Kt99CQMDuVetoL1lrYwg5t+9QdHe7NLX/SoJYkXDFfX37iInKRy5xLSi8nO7UC" crossorigin="anonymous"></script>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
  {% block extra_js %}{% endblock %}

  {% if messages %}
  <script>
    // Espera a que la página cargue
    document.addEventListener('DOMContentLoaded', function() {
      
      // Configura el estilo del "Toast" de SweetAlert
      const Toast = Swal.mixin({
        toast: true,
        position: 'top-end', // Arriba a la derecha
        showConfirmButton: false,
        timer: 3500, // Duración de 3.5 segundos
        timerProgressBar: true,
        didOpen: (toast) => {
          toast.addEventListener('mouseenter', Swal.stopTimer);
          toast.addEventListener('mouseleave', Swal.resumeTimer);
        }
      });

      // Itera sobre los mensajes que envió Django
      {% for m in messages %}
        Toast.fire({
          // Asigna un ícono según la "etiqueta" del mensaje
          icon: '{% if m.tags == "error" %}error{% elif m.tags == "success" %}success{% elif m.tags == "warning" %}warning{% else %}info{% endif %}',
          // Muestra el texto del mensaje
          title: '{{ m|escapejs }}'
        });
      {% endfor %}
    });
  </script>
  {% endif %}
  </body>
</html>