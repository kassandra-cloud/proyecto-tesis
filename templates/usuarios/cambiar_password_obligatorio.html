{% extends "base_public.html" %}
{% load widget_tweaks %}
{% load static %}

{% block title %}Configurar Contraseña{% endblock %}

{% block content %}
<style>
  /* --- Estilos Generales --- */
  .auth-container {
    background: #fff;
    border-radius: 1rem;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1); /* Sombra suave */
    overflow: hidden;
    max-width: 900px;
    width: 100%;
    min-height: 550px;
  }

  /* Columna Izquierda (Decorativa) */
  .auth-side-decor {
    background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 3rem;
    color: white;
    text-align: center;
  }

  /* Columna Derecha (Formulario) */
  .auth-side-form {
    padding: 3rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  /* Estilo del Botón de Ojo */
  .btn-toggle-pass {
    border-color: #dee2e6;
    background-color: white;
    color: #6c757d;
    z-index: 10; /* Asegura que esté encima */
    cursor: pointer;
  }
  .btn-toggle-pass:hover {
    background-color: #f8f9fa;
    color: #0d6efd;
    border-color: #dee2e6;
  }
  
  /* Input Focus */
  .form-control:focus {
    border-color: #86b7fe;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    z-index: 5;
  }
</style>

<div class="d-flex justify-content-center align-items-center p-4" style="min-height: 100vh; background-color: #f0f2f5;">
    
    <div class="auth-container row g-0">
        
        <div class="col-md-5 d-none d-md-flex auth-side-decor">
            <div class="mb-4">
               <img src="{% static 'img/logo3.png' %}" alt="Logo" style="width: 120px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));">
            </div>
            <h3 class="fw-bold mb-3">Actualización de Seguridad</h3>
            <p class="opacity-75">
                Para garantizar la seguridad de tu cuenta y los datos de la comunidad, necesitamos que definas una nueva contraseña privada.
            </p>
        </div>

        <div class="col-md-7 auth-side-form">
            
            <div class="text-center mb-4">
                <h2 class="h4 fw-bold text-primary"><i class="fas fa-lock me-2"></i>Nueva Contraseña</h2>
                <p class="text-muted small">Ingresa tus nuevas credenciales a continuación.</p>
            </div>

            <form method="post">
                {% csrf_token %}
                
                {% for field in form %}
                <div class="mb-3">
                    <label class="form-label fw-semibold small text-muted text-uppercase" for="{{ field.auto_id }}">
                        {{ field.label }}
                    </label>

                    <div class="input-group">
                        {{ field|add_class:"form-control"|attr:"placeholder:******" }}
                        
                        <button class="btn btn-toggle-pass" type="button" 
                                onclick="toggleMyInput('{{ field.auto_id }}', this)">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>

                    {% if field.help_text and forloop.first %}
                        <div class="form-text small mt-1"><i class="fas fa-info-circle"></i> {{ field.help_text }}</div>
                    {% endif %}

                    {% for error in field.errors %}
                        <div class="text-danger small mt-1 fw-bold">
                            <i class="fas fa-exclamation-triangle"></i> {{ error }}
                        </div>
                    {% endfor %}
                </div>
                {% endfor %}
                
                <div class="d-grid gap-2 mt-4">
                    <button type="submit" class="btn btn-primary btn-lg fw-bold shadow-sm">
                        Confirmar Cambio
                    </button>
                </div>

                <div class="text-center mt-3">
                    <button type="submit" form="logout-form" class="btn btn-link text-decoration-none text-muted small">
                        Cancelar y salir
                    </button>
                </div>
            </form>

            <form id="logout-form" action="{% url 'logout' %}" method="post" style="display: none;">
                {% csrf_token %}
            </form>

        </div>
    </div>
</div>

<script>
    function toggleMyInput(fieldId, btnElement) {
        // 1. Buscamos el input por su ID exacto (generado por Django)
        var input = document.getElementById(fieldId);
        var icon = btnElement.querySelector('i');

        if (input) {
            if (input.type === "password") {
                input.type = "text";
                // Cambiar icono a "ojo tachado"
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
                // Cambiar color para indicar "alerta/visible"
                btnElement.classList.add('text-primary');
            } else {
                input.type = "password";
                // Volver a icono normal
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
                btnElement.classList.remove('text-primary');
            }
        } else {
            console.error("No se encontró el input con ID:", fieldId);
        }
    }
</script>

{% endblock %}